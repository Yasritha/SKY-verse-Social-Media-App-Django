<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home | SKYverse</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/home.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"> <!-- Font Awesome CSS -->
    <style>
        .nav-icon {
            font-size: 20px; /* Increase icon size */
        }
        .toggle-mode-icon {
            font-size: 24px;
            color: #333;
            cursor: pointer;
            position: fixed;
            top: 20px;
            right: 20px;
        }
        .toggle-mode-icon.hide {
            display: none; /* Hide the toggle icon initially */
        }
        .post {
            margin-bottom: 15px;
            padding: 10px; /* Adjust padding */
            max-width: 100%; /* Ensure post does not overflow */
        }
        .red-dot {
            height: 10px;
            width: 10px;
            background-color: red;
            border-radius: 50%;
            display: inline-block;
        }
        .notification {
            display: none; /* Hide all notifications initially */
        }
        .profile-photo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .user-info .username {
            margin-right: 10px;
        }
        .btn-group {
            margin-left: auto; /* Push buttons to the right */
        }
        .card-title {
            font-size: 1.1rem; /* Slightly smaller title */
        }
        .card-text {
            font-size: 0.9rem; /* Slightly smaller text */
        }
        .friends-posts-container {
            height: 600px; /* Fixed height for the container */
            width:700px;
            overflow-x: scroll;
           
}

        .friend-profile-info {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        .friend-profile-info .profile-photo {
            margin-right: 10px;
        }
        .profile-details {
            display: flex;
            flex-direction: column; /* Stack username and bio vertically */
        }

        .username {
            font-weight: bold;
        }
        .bio {
            font-size: 0.9rem; /* Adjust font size for the bio */
            color: #666; /* Optional: Color for the bio text */
            margin-top: 2px; /* Add some space between username and bio */
        }
        @media (min-width: 768px) {
            .post {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light">
                <a class="navbar-brand" href="#">SKYverse</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="#"><i class="fas fa-home nav-icon"></i> Home</a>
                        </li>
                        <li class="nav-item">
                            <a href="{% url 'explore' %}" class="nav-link"><i class="fas fa-compass nav-icon"></i> Explore</a>
                        </li>
                        <li class="nav-item">
                            <a href="{% url 'create_post' %}" class="nav-link"><i class="fas fa-plus-square nav-icon"></i> Post</a>
                        </li>
                        <li>
                            <a href="{% url 'view_friends' %}" class="nav-link">
                                <i class="fas fa-comment-dots nav-icon"></i>
                                <span class="notification-dot" id="notificationDot" style="display: none;"></span>
                                Chats
                            </a>
                        </li>
                    </ul>

                    <ul class="navbar-nav ml-auto">
                        <!-- Toggle mode icon -->
                        <a href="{% url 'switch_mode' 'kids' %}" class="toggle-mode-icon"><i class="fas fa-child nav-icon"></i></a>
                        <li class="nav-item user-info">
                            <a class="nav-link" href="{% url 'profile' %}">{% if user.profile.profile_photo %}
                                <img src="{{ user.profile.profile_photo.url }}" alt="Profile Photo" class="profile-photo">
                            {% else %}
                                <img src="/media/profile_photos/default_profile.jpg" alt="Default Profile Photo" class="profile-photo">
                            {% endif %}
                            {{ user.username }}</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'login' %}"><i class="fas fa-sign-out-alt nav-icon"></i> Logout</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    <!-- Main feed -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="card-title">Friend's Posts</h5>
                            <!-- Container for fixed-height and scrolling -->
                            <div class="friends-posts-container">
                                <div class="row">
                                    {% if friends_posts %}
                                        {% for post in friends_posts %}
                                            <div class="col-md-6 mb-3">
                                                <div class="post card">
                                                    <div class="card-body">
                                                        {% if post.image %}
                                                            <img src="{{ post.image.url }}" class="img-fluid mb-2" alt="Post Image">
                                                        {% endif %}
                                                        {% if post.video %}
                                                            <video width="100%" height="auto" controls class="mb-2">
                                                                <source src="{{ post.video.url }}" type="video/mp4">
                                                                Your browser does not support the video tag.
                                                            </video>
                                                        {% endif %}
                                                        {% if post.link %}
                                                             <p><a href="{{ post.link }}" target="_blank">{{ post.link }}</a></p>
                                                        {% endif %}
                                                    
                                                        <p class="card-text">{{ post.content }}</p>
                                                        <p class="card-text text-muted"><small>Posted on {{ post.created_at|date:"F j, Y, g:i a" }}</small></p>

                                                        <!-- Display friend's profile photo below post content -->
                                                        <div class="friend-profile-info">
                                                            {% if post.author.profile.profile_photo %}
                                                                <img src="{{ post.author.profile.profile_photo.url }}" alt="Profile Photo" class="profile-photo">
                                                            {% else %}
                                                                <img src="/static/images/default_profile_photo.jpg" alt="Default Profile Photo" class="profile-photo">
                                                            {% endif %}
                                                            <div class="profile-details">
                                                                <span class="username">{{ post.author.username }}</span>
                                                                <p class="bio">{{ post.author.profile.bio }}</p> <!-- Display the bio below the username -->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <p>No posts from friends yet.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <!-- Sidebar with icons -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="card-title">Quick Access</h5>
                            <ul class="icon-list">
                                <li>
                                    <a href="#" id="toggleFriends"><i class="fas fa-user-friends"></i> Friends</a>
                                    <div class="notification" id="friendsList">
                                        {% if friends %}
                                            {% for friend in friends %}
                                                <div class="friend-item user-info">
                                                    <img src="{{ friend.profile_photo.url }}" alt="Profile Photo" class="profile-photo">
                                                    <div class="profile-details">
                                                    <span class="username">{{ friend.user.username }}</span>
                                                    <p class="bio">{{ friend.user.profile.bio }}</p>
                                                    </div>


                                                </div>
                                            {% endfor %}
                                        {% else %}
                                            <p>No friends yet.</p>
                                        {% endif %}
                                    </div>
                                </li>
                                <li>
                                    <a href="#" id="toggleRequests"><i class="fas fa-user-plus"></i> Friend Requests</a>
                                    <div class="notification" id="friendRequests">
                                        {% if friend_requests %}
                                            {% for request in friend_requests %}
                                                <div class="user-info">
                                                    {% if request.from_user.profile.profile_photo %}
                                                        <img src="{{ request.from_user.profile.profile_photo.url }}" alt="Profile Photo" class="profile-photo">
                                                    {% else %}
                                                        <img src="/static/images/default_profile_photo.jpg" alt="Default Profile Photo" class="profile-photo">
                                                    {% endif %}
                                                    <span class="username">{{ request.from_user.username }}</span>
                                                    <div class="btn-group">
                                                        <a href="{% url 'accept_friend_request' request.id %}" class="btn btn-primary btn-sm">Accept</a>
                                                        <a href="{% url 'ignore_friend_request' request.id %}" class="btn btn-danger btn-sm">Reject</a>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        {% else %}
                                            <p>No friend requests.</p>
                                        {% endif %}
                                    </div>
                                </li>
                                <li>
                                    <a href="#" id="toggleSuggestions"><i class="fas fa-user-check"></i> Friend Suggestions</a>
                                    <div class="notification" id="friendSuggestions">
                                        {% if friend_suggestions %}
                                            {% for user in friend_suggestions %}
                                                <div class="user-info">
                                                    {% if user.profile.profile_photo %}
                                                        <img src="{{ user.profile.profile_photo.url }}" alt="Profile Photo" class="profile-photo">
                                                    {% else %}
                                                        <img src="/static/images/default_profile_photo.jpg" alt="Default Profile Photo" class="profile-photo">
                                                    {% endif %}
                                                    <span class="username">{{ user.username }}</span>
                                                    <div class="btn-group">
                                                        <a href="{% url 'send_friend_request' user.id %}" class="btn btn-primary btn-sm add-friend-button">Add Friend</a>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        {% else %}
                                            <p>No friend suggestions.</p>
                                        {% endif %}
                                    </div>
                                </li>
                                <li>
                                </li>
                                <li>
                            
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        // JavaScript to toggle visibility of notification sections
        document.getElementById('toggleFriends').addEventListener('click', function() {
            var friendsList = document.getElementById('friendsList');
            friendsList.style.display = friendsList.style.display === 'none' ? 'block' : 'none';
        });

        document.getElementById('toggleRequests').addEventListener('click', function() {
            var friendRequests = document.getElementById('friendRequests');
            friendRequests.style.display = friendRequests.style.display === 'none' ? 'block' : 'none';
        });

        document.getElementById('toggleSuggestions').addEventListener('click', function() {
            var friendSuggestions = document.getElementById('friendSuggestions');
            friendSuggestions.style.display = friendSuggestions.style.display === 'none' ? 'block' : 'none';
        });

        // Script to handle friend request sending
        document.querySelectorAll('.add-friend-button').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const url = this.getAttribute('href');
                fetch(url, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                })
                .then(response => {
                    if (response.ok) {
                        alert('Friend request sent!');
                    } else {
                        alert('Failed to send friend request.');
                    }
                });
            });
        });

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html>
